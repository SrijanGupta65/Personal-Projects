import React from 'react';
import useMediaQuery from '../utils/useMediaQuery';

const PlantStatusIndicators = ({ lastWatered, sunExposure }) => {
  const isDesktop = useMediaQuery('(min-width: 768px)');

  // --- Sizing ---
  const size = isDesktop ? 80 : 48;
  const strokeWidth = isDesktop ? 8 : 5;
  const radius = (size - strokeWidth) / 2;
  const center = size / 2;
  const circumference = 2 * Math.PI * radius;
  const iconSize = isDesktop ? 32 : 20;
  const fontSize = isDesktop ? 14 : 12;

  // --- Logic ---
  const now = new Date();
  const daysSinceWatered = lastWatered ? (now - new Date(lastWatered)) / (1000 * 60 * 60 * 24) : 7;
  
  const waterLevel = Math.max(0, 1 - (daysSinceWatered / 7));
  const sunlightLevel = (sunExposure || 0) / 100;
  const happinessLevel = (waterLevel + sunlightLevel) / 2;

  // --- Colors ---
  const waterColor = `rgba(41, 98, 255, ${0.3 + 0.7 * waterLevel})`;
  const sunlightColor = `rgba(255, 214, 0, ${0.3 + 0.7 * sunlightLevel})`;
  const happinessColor = `rgba(67, 160, 71, ${0.3 + 0.7 * happinessLevel})`;
  const grayColor = '#e0e0e0';

  const Indicator = ({ level, color, Icon, label }) => (
    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: isDesktop ? 8 : 4 }}>
      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
        {/* Background Circle */}
        <circle cx={center} cy={center} r={radius} stroke={grayColor} strokeWidth={strokeWidth} fill="none" />
        {/* Progress Circle */}
        <circle
          cx={center}
          cy={center}
          r={radius}
          stroke={color}
          strokeWidth={strokeWidth}
          fill="none"
          strokeDasharray={circumference}
          strokeDashoffset={circumference * (1 - level)}
          transform={`rotate(-90 ${center} ${center})`}
          style={{ transition: 'stroke-dashoffset 0.5s ease, stroke 0.5s ease' }}
        />
        <foreignObject x={(size - iconSize) / 2} y={(size - iconSize) / 2} width={iconSize} height={iconSize}>
          <Icon />
        </foreignObject>
      </svg>
      <span style={{ fontSize, color: '#666', fontWeight: 500 }}>{label}</span>
    </div>
  );
  
  const WaterIcon = () => (
    <svg width="100%" height="100%" viewBox="0 0 13 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M6.07724 16C4.34269 16 2.89631 15.3573 1.73809 14.0718C0.57987 12.7863 0.000506436 11.1863 0 9.2718C0 8.42394 0.177253 7.57607 0.531758 6.72821C0.886263 5.88035 1.3294 5.06667 1.86115 4.28719C2.39291 3.5077 2.96898 2.77608 3.58937 2.09232C4.20975 1.40856 4.78582 0.813684 5.31758 0.307701C5.41887 0.1983 5.53611 0.119804 5.6693 0.0722143C5.80249 0.0246245 5.93847 0.000556125 6.07724 9.11679e-06C6.216 -0.000537891 6.35223 0.0235305 6.48593 0.0722143C6.61963 0.120898 6.73662 0.199394 6.83689 0.307701C7.36865 0.813684 7.94472 1.40856 8.5651 2.09232C9.18549 2.77608 9.76156 3.5077 10.2933 4.28719C10.8251 5.06667 11.2682 5.88035 11.6227 6.72821C11.9772 7.57607 12.1545 8.42394 12.1545 9.2718C12.1545 11.1863 11.5754 12.7863 10.4171 14.0718C9.25892 15.3573 7.81229 16 6.07724 16ZM6.07724 14.359C7.39397 14.359 8.48281 13.8768 9.34375 12.9124C10.2047 11.948 10.6352 10.7345 10.6352 9.2718C10.6352 8.27351 10.252 7.1453 9.48581 5.88719C8.71957 4.62907 7.58338 3.25471 6.07724 1.76411C4.57059 3.25471 3.4344 4.62907 2.66867 5.88719C1.90293 7.1453 1.51982 8.27351 1.51931 9.2718C1.51931 10.735 1.94978 11.9489 2.81072 12.9132C3.67166 13.8776 4.7605 14.3595 6.07724 14.359ZM6.28614 13.5385C6.43807 13.5248 6.56797 13.4597 6.67584 13.3432C6.78372 13.2267 6.8374 13.0866 6.83689 12.9231C6.83689 12.7316 6.77992 12.5779 6.66597 12.462C6.55202 12.346 6.40642 12.2946 6.22917 12.3077C5.71007 12.3487 5.15932 12.195 4.57692 11.8466C3.99452 11.4981 3.62735 10.8655 3.47542 9.94872C3.4501 9.7983 3.38375 9.67522 3.27639 9.57949C3.16903 9.48377 3.04545 9.4359 2.90568 9.4359C2.72843 9.4359 2.58283 9.50783 2.46888 9.6517C2.35493 9.79556 2.31695 9.96294 2.35493 10.1538C2.57016 11.3983 3.0766 12.2872 3.87424 12.8205C4.67188 13.3538 5.47584 13.5932 6.28614 13.5385Z" fill="black"/>
    </svg>
  );

  const SunIcon = () => (
    <svg width="100%" height="100%" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M4.4744 13.5256L3.3432 14.6568M4.4744 4.4744L3.3432 3.3432M13.5256 4.4744L14.6568 3.3432M13.5256 13.5256L14.6568 14.6568M2.6 9H1M9 2.6V1M15.4 9H17M9 15.4V17M11.2624 11.2624C11.568 10.9672 11.8118 10.6141 11.9795 10.2237C12.1472 9.83328 12.2355 9.41338 12.2392 8.98848C12.2429 8.56359 12.1619 8.14221 12.001 7.74895C11.8401 7.35568 11.6025 6.99839 11.3021 6.69794C11.0016 6.39748 10.6443 6.15987 10.2511 5.99897C9.85778 5.83807 9.43641 5.75711 9.01152 5.7608C8.58662 5.76449 8.16672 5.85277 7.77631 6.02048C7.38589 6.18818 7.03279 6.43197 6.7376 6.7376C6.15469 7.34113 5.83215 8.14945 5.83944 8.98848C5.84673 9.82751 6.18327 10.6301 6.77658 11.2234C7.36989 11.8167 8.17249 12.1533 9.01152 12.1606C9.85055 12.1678 10.6589 11.8453 11.2624 11.2624Z" stroke="black" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
    </svg>
  );

  const HappinessIcon = ({ level }) => {
    if (level > 0.6) {
      return (
        <svg width="100%" height="100%" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10ZM20 10C20 12.6522 18.9464 15.1957 17.0711 17.0711C15.1957 18.9464 12.6522 20 10 20C8.68678 20 7.38642 19.7413 6.17317 19.2388C4.95991 18.7362 3.85752 17.9997 2.92893 17.0711C1.05357 15.1957 0 12.6522 0 10C0 7.34784 1.05357 4.8043 2.92893 2.92893C4.8043 1.05357 7.34784 0 10 0C11.3132 0 12.6136 0.258658 13.8268 0.761205C15.0401 1.26375 16.1425 2.00035 17.0711 2.92893C17.9997 3.85752 18.7362 4.95991 19.2388 6.17317C19.7413 7.38642 20 8.68678 20 10ZM8 7.5C8 8.3 7.3 9 6.5 9C5.7 9 5 8.3 5 7.5C5 6.7 5.7 6 6.5 6C7.3 6 8 6.7 8 7.5ZM15 7.5C15 8.3 14.3 9 13.5 9C12.7 9 12 8.3 12 7.5C12 6.7 12.7 6 13.5 6C14.3 6 15 6.7 15 7.5ZM10 15.23C8.25 15.23 6.71 14.5 5.81 13.42L7.23 12C7.68 12.72 8.75 13.23 10 13.23C11.25 13.23 12.32 12.72 12.77 12L14.19 13.42C13.29 14.5 11.75 15.23 10 15.23Z" fill="#205624"/>
        </svg>
      );
    }
    if (level > 0.3) {
      return (
        <svg width="100%" height="100%" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clipPath="url(#clip0_336_249)">
            <path d="M18.125 10C18.125 12.1549 17.269 14.2215 15.7452 15.7452C14.2215 17.269 12.1549 18.125 10 18.125C7.84512 18.125 5.77849 17.269 4.25476 15.7452C2.73102 14.2215 1.875 12.1549 1.875 10C1.875 7.84512 2.73102 5.77849 4.25476 4.25476C5.77849 2.73102 7.84512 1.875 10 1.875C12.1549 1.875 14.2215 2.73102 15.7452 4.25476C17.269 5.77849 18.125 7.84512 18.125 10ZM10 0C7.34784 0 4.8043 1.05357 2.92893 2.92893C1.05357 4.8043 0 7.34784 0 10C0 12.6522 1.05357 15.1957 2.92893 17.0711C4.8043 18.9464 7.34784 20 10 20C12.6522 20 15.1957 18.9464 17.0711 17.0711C18.9464 15.1957 20 12.6522 20 10C20 7.34784 18.9464 4.8043 17.0711 2.92893C15.1957 1.05357 12.6522 0 10 0ZM6.89062 9.375C7.22215 9.375 7.54009 9.2433 7.77451 9.00888C8.00893 8.77446 8.14062 8.45652 8.14062 8.125C8.14062 7.79348 8.00893 7.47554 7.77451 7.24112C7.54009 7.0067 7.22215 6.875 6.89062 6.875C6.5591 6.875 6.24116 7.0067 6.00674 7.24112C5.77232 7.47554 5.64062 7.79348 5.64062 8.125C5.64062 8.45652 5.77232 8.77446 6.00674 9.00888C6.24116 9.2433 6.5591 9.375 6.89062 9.375ZM14.3906 8.125C14.3906 7.79348 14.2589 7.47554 14.0245 7.24112C13.7901 7.0067 13.4721 6.875 13.1406 6.875C12.8091 6.875 12.4912 7.0067 12.2567 7.24112C12.0223 7.47554 11.8906 7.79348 11.8906 8.125C11.8906 8.45652 12.0223 8.77446 12.2567 9.00888C12.4912 9.2433 12.8091 9.375 13.1406 9.375C13.4721 9.375 13.7901 9.2433 14.0245 9.00888C14.2589 8.77446 14.3906 8.45652 14.3906 8.125ZM7.1875 12.8125C6.66797 12.8125 6.25 13.2305 6.25 13.75C6.25 14.2695 6.66797 14.6875 7.1875 14.6875H12.8125C13.332 14.6875 13.75 14.2695 13.75 13.75C13.75 13.2305 13.332 12.8125 12.8125 12.8125H7.1875Z" fill="#205624"/>
          </g>
          <defs>
            <clipPath id="clip0_336_249">
              <rect width="20" height="20" fill="white"/>
            </clipPath>
          </defs>
        </svg>
      );
    }
    return (
      <svg width="100%" height="100%" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10ZM20 10C20 12.6522 18.9464 15.1957 17.0711 17.0711C15.1957 18.9464 12.6522 20 10 20C8.68678 20 7.38642 19.7413 6.17317 19.2388C4.95991 18.7362 3.85752 17.9997 2.92893 17.0711C1.05357 15.1957 0 12.6522 0 10C0 7.34784 1.05357 4.8043 2.92893 2.92893C4.8043 1.05357 7.34784 0 10 0C11.3132 0 12.6136 0.258658 13.8268 0.761205C15.0401 1.26375 16.1425 2.00035 17.0711 2.92893C17.9997 3.85752 18.7362 4.95991 19.2388 6.17317C19.7413 7.38642 20 8.68678 20 10ZM13.5 6C14.3 6 15 6.7 15 7.5C15 8.3 14.3 9 13.5 9C12.7 9 12 8.3 12 7.5C12 6.7 12.7 6 13.5 6ZM8 7.5C8 8.3 7.3 9 6.5 9C5.7 9 5 8.3 5 7.5C5 6.7 5.7 6 6.5 6C7.3 6 8 6.7 8 7.5ZM10 12C11.75 12 13.29 12.72 14.19 13.81L12.77 15.23C12.32 14.5 11.25 14 10 14C8.75 14 7.68 14.5 7.23 15.23L5.81 13.81C6.71 12.72 8.25 12 10 12Z" fill="#205624"/>
      </svg>
    );
  };

  return (
    <div style={{ display: 'flex', gap: isDesktop ? 24 : 16 }}>
      <Indicator level={waterLevel} color={waterColor} Icon={WaterIcon} label="Water" />
      <Indicator level={sunlightLevel} color={sunlightColor} Icon={SunIcon} label="Sunlight" />
      <Indicator level={happinessLevel} color={happinessColor} Icon={() => <HappinessIcon level={happinessLevel} />} label="Happiness" />
    </div>
  );
};

export default PlantStatusIndicators; 